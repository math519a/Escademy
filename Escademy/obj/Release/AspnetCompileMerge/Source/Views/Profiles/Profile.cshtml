@model IEnumerable<Escademy.ViewModels.ReviewDetailModel>
@using Escademy.Helpers;
@using Escademy.Dal;
@using Escademy.ViewModels;
@using Escademy.Models;
@{
    ViewBag.Title = "Profile";
}
@{
    User sessionUser = null;
    if (Session["user"] != null)
    {
        sessionUser = (User)Session["user"];
    }
    var gameRatings = new List<GameVM>();
    var uGames = new List<GameVM>();
    var uTrophies = new List<esc_profileTrophies>();
    uTrophies = ViewBag.userTrophies;
    uGames = ViewBag.userGames;
    gameRatings = ViewBag.gameRatings;
    System.Collections.Generic.List<Escademy.Dal.esc_games> gamesAbbr = ViewBag.gamesAbbr;
}
@section styles {
    @*<meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">*@
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link media="all" rel="stylesheet" href="~/Content/css/main.css">
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,300' rel='stylesheet' type='text/css'>
    <link href="~/Content/profile-img.css" type="text/css" rel="stylesheet" />
    <style>
        .cf {
            position: relative;
            height: 230px;
        }

            .cf img {
                position: absolute;
                left: 0;
                -webkit-transition: opacity 250ms ease-in-out;
                -moz-transition: opacity 250ms ease-in-out;
                -o-transition: opacity 250ms ease-in-out;
                transition: opacity 250ms ease-in-out;
            }

                .cf img.top:hover {
                    opacity: 0;
                }

        .add {
            color: #00698c;
            font-size: 14px;
            font-weight: 400;
            float: right;
        }

        .btn-lrg-standard {
            background-color: #f25a29;
            font: 700 16px/16px "Helvetica Neue", Helvetica, Arial, sans-serif;
            color: #fff;
            border: 1px solid transparent;
            padding: 15px 35px;
            padding: 11px 22px;
            font-size: 14px;
            float: right;
            margin-top: 15px;
            width: calc((100% - 15px)/2);
            padding: 11px 22px;
            font-size: 14px
        }

            .btn-lrg-standard:hover {
                background-color: #ffa73c;
            }

        .cancel {
            float: none;
            margin-right: 15px;
            background-color: #fff;
        }

        .btn-white {
            background: 0 0;
            background-color: #fff;
            font-weight: 500;
            color: #777;
            border-color: #ccc;
            text-shadow: none;
        }

        .capitalize {
            width: 100%;
            font-size: 14px;
            border-color: #e5e5e5;
            margin-right: 0 !important;
            -webkit-appearance: none;
            background-color: #fff;
            font: 400 12px helvetica neue,Helvetica,Arial,sans-serif;
            color: #777;
            border: 1px #b2b2b2 solid;
            padding: 6px 7px 7px;
            margin: 0;
            resize: none;
            border-radius: 3px;
            box-sizing: border-box;
            vertical-align: middle;
            text-transform: capitalize;
            margin-bottom: 10px;
            -webkit-font-smoothing: antialiased;
            vertical-align: middle;
            height: 40px;
        }

        .buttons-wrapper {
            Display: block;
            padding-top: 15px;
            margin-top: 15px;
            border-top: 1px solid #e5e5e5;
        }

        .delete-lang {
            cursor: pointer;
        }

            .delete-lang:hover {
                background-color: #dc7474;
                color: #fff;
            }
        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }
        /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: #000;
                text-decoration: none;
                cursor: pointer;
            }
    </style>
}
@section scripts {
    <!-- Start Conversation JS reference-->
    <script src="/Scripts/conversation.js"></script>
    <script>
        $('#fileUpload').on('change', function () {
            $('.avatar1').removeClass('open');
        });
        $('.avatar1').on('click', function () {
            $(this).addClass('open');
        });
        $('html').click(function () {
            $('.avatar1').removeClass('open');
        });
        $('.avatar1').click(function (event) {
            event.stopPropagation();
        });
        document.getElementById("fileUpload").onchange = function () {
            document.getElementById("newPictureForm").submit();
        };
    </script>
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");
        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        //// When the user clicks the button, open the modal
        //btn.onclick = function () {
        //    modal.style.display = "block";
        //}
        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }
        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        //$("#modal").click(function (e) {
        //    debugger;
        //    $("#myModal").modal("show");
        //});
        $(document).ready(function () {
            var myVal = avgStarVal;
            if (myVal == "4.5") {
                document.getElementById('star1').style.display = 'none';
            } else {
                document.getElementById('star2').style.display = 'block';
            }
        });
        $("#updateLanguageForm").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr('action');
            $.ajax({
                type: "POST",
                url: url,
                contentType: "application/x-www-form-urlencoded",
                data: form.serialize(),
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            hideAddLanguage();
                            var changed = false;
                            $("#showLanguage li").each(function (i, e) {
                                if (parseInt($(e).attr("data-id")) == parseInt(data.language)) {
                                    changed = true;
                                    // TODO: Update language.
                                    $(e).find("span").first().text(data.levelText);
                                }
                            });
                            // Insert new language
                            if (!changed) {
                                //<li class="langli" data-id="2">Afrikanns - <span>3</span></li>
                                var newElement = $("<li></li>")
                                    .addClass("langli")
                                    .attr("data-id", data.language)
                                    .text(" " + data.languageText + " - ");
                                var spanElement = $("<span></span>")
                                    .text(data.levelText);
                                newElement.append(spanElement);
                                // <i data-id=" .. " onclick="deleteLanguage(this)" class="far fa-window-close delete-lang"></i>
                                var liElement = $("<li></li>")
                                    .addClass("far fa-window-close delete-lang")
                                    .attr("onclick", "deleteLanguage(this);")
                                    .attr("data-id", data.language);
                                newElement.prepend(liElement);
                                $("#showLanguage").append(newElement);
                            }
                        }
                    }
                }
            });
        });
        $("#updateTrophyForm").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr('action');
            $.ajax({
                type: "POST",
                url: url,
                contentType: "application/x-www-form-urlencoded",
                data: form.serialize(),
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            hideById('trophy');
                            showById('trophies');
                            var deleteBtn = '<i data-id=' + data.id + ' title="Delete" style="position: inherit; " onclick="deleteRating(this)" class="far fa - window - close delete -lang"></i>';
                            var trophy = deleteBtn + "<span id=" + data.id + ">" + data.description + "</span><br />"
                            $("#trophies").append(trophy);
                        }
                    }
                }
            });
        });
        $("#updateRatingForm").submit(function (e) {
            e.preventDefault();
            debugger;
            var form = $(this);
            form.add("game_Id", parseInt($("#ratingDropdown").val()));
            var url = form.attr('action');
            var name = $("#ratingDropdown option:selected").html();
            $.ajax({
                type: "POST",
                url: url,
                contentType: "application/x-www-form-urlencoded",
                data: form.serialize(),
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            hideById('rating');
                            showById('ratings');
                            var deleteBtn = '<i data-id='+ data.id + ' title="Delete" style="position: inherit; " onclick="deleteRating(this)" class="far fa - window - close delete -lang"></i>';
                            var rating = deleteBtn + "<span id=" + data.id + ">" + name + " :" + data.description + "</span><br />"
                            $("#ratings").append(rating);
                        }
                    }
                }
            });
        });
        $("#editdescription").click(function (e) {
            e.preventDefault();
            showEditDescription();
        });
        $("#addlanguage").click(function (e) {
            e.preventDefault();
            showAddLanguage();
        });
        $("#updateDescriptionForm").submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var url = form.attr('action');
            $.ajax({
                type: "GET",
                url: url,
                contentType: "application/x-www-form-urlencoded",
                data: form.serialize(),
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            hideEditDescription();
                            $("#description").text(data.description);
                        }
                    }
                }
            });
        });
        function showEditDescription() {
            if (document.getElementById("editdescription").click) {
                document.getElementById("descriptioninfo").style.display = "block";
                document.getElementById("description").style.display = "none";
            }
        }
        function hideEditDescription() {
            if (document.getElementById("cancelEdit").click) {
                document.getElementById("descriptioninfo").style.display = "none";
                document.getElementById("description").style.display = "block";
            }
        }
        function deleteLanguage(input) {
            var elem = $(input);
            var id = elem.attr("data-id");
            $.ajax({
                type: "GET",
                url: "@Url.Action("DeleteLanguage", "api/User")",
                data: {
                    language: id
                },
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            $(elem.parent()).remove();
                        }
                    }
                }
            });
        }
        function deleteTrophy(input) {
            var elem = $(input);
            var id = elem.attr("data-id");
            $.ajax({
                type: "GET",
                url: "@Url.Action("DeleteTrophy", "api/User")",
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            $(elem.parent()).remove();
                        }
                    }
                }
            });
        }
        function deleteRating(input) {
            var elem = $(input);
            var id = elem.attr("data-id");
            $.ajax({
                type: "GET",
                url: "@Url.Action("DeleteRating", "api/User")",
                data: {
                    id: id
                },
                success: function (data) {
                    if (data.auth == "OK") {
                        if (data.success) {
                            $(elem.parent()).remove();
                        }
                    }
                }
            });
        }
        function showAddLanguage() {
            if (document.getElementById("addlanguage").click) {
                document.getElementById("language").style.display = "block";
                document.getElementById("showLanguage").style.display = "none";
            }
        }
        function hideAddLanguage() {
            document.getElementById("language").style.display = "none";
            document.getElementById("showLanguage").style.display = "block";
        }
        function hideById(id) {
            $("#" + id).hide();
        }
        function showById(id) {
            $("#" + id).show();
        }
        function showAddSkill() {
            if (document.getElementById("addSkill").click) {
                document.getElementById("editSkill").style.display = "block";
                document.getElementById("showSkill").style.display = "none";
            }
        }
        function hideAddSkill() {
            if (document.getElementById("cancelAddLanguage").click) {
                document.getElementById("editSkill").style.display = "none";
                document.getElementById("showSkill").style.display = "block";
            }
        }
    </script>
}
@{
    var dbConnection = new MySql.Data.MySqlClient.MySqlConnection(ConnectionString.Get("EscademyDB"));
    if (ViewBag.user == null)
    {
        <section class="jumbotron text-center">
            <div class="container">
                <h1 class="display-3">Profile not found</h1>
            </div>
        </section>
    }
    else
    {
        var user = (User)ViewBag.user;
        if (user.Level == (int)UserLevel.Coach)
        {
            dbConnection.Open();
            var gameCoaches = new List<GameCoaching>();
            using (var cmd = dbConnection.CreateCommand())
            {
                cmd.CommandText = "SELECT IFNULL((SELECT p1.Price FROM esc_profilegamesPricing p1 WHERE p1.profilegamesId=p.Id order by p1.Hours ASC Limit 1),0) As Price,a.FirstName" +
                            ",IFNULL((SELECT f.FileName FROM esc_profilegamesFiles f WHERE f.profilegamesId=p.Id AND f.FileType=1 order by f.Id ASC Limit 1),0) As Image" +
                            ",a.Id" +
                            ",a.ProfilePicture" +
                            ",a.Created_at" +
                            ",p.accountId" +
                            ",p.title" +
                            ",p.SalaryUSD" +
                            ",p.gameId" +
                            ",p.Id as GID" +
                            ",p.Verified" +
                            ",p.serviceTypeId" +
                            ",g.Game" +
                            ",g.Abbreviation" +
                            ",g.Picture" +
                            ",a.Email" +
                            ",(select COUNT(order_status) from esc_orders e WHERE e.order_status='completed' AND e.receiver_id=a.Id) as TotalCoached" +
                                " FROM esc_profilegames p" +
                                " JOIN esc_accounts a ON a.Id = p.accountId" +
                                " JOIN esc_games g ON p.gameId = g.Id WHERE p.accountId=@id";
                cmd.Parameters.AddWithValue("@id", (int)ViewBag.id);
                var reader = cmd.ExecuteReader();
                while (reader.Read())
                {
                    gameCoaches.Add(new GameCoaching()
                    {
                        Verified = reader.GetInt32("Verified"),
                        AccountId = reader.GetInt32("accountId"),
                        SalaryUSD = reader.GetDecimal("SalaryUSD"),
                        Game = reader.GetString("Game"),
                        Picture = reader.GetString("Picture"),
                        Abbreviation = reader.GetString("Abbreviation"),
                        GameId = reader.GetInt32("gameId"),
                        Title = reader.GetString("Title"),
                        Price = reader.GetString("Price"),
                        GamePicture = reader.GetString("Image"),
                        UserEmail = reader.GetString("Email"),
                        TotalCoached = reader.GetInt32("TotalCoached"),
                        ServiceType = reader.GetInt32("serviceTypeId"),
                        Id = reader.GetInt32("GID")
                    });
                }
            }
            var languages = new List<UserLanguage>();
            using (var cmd = dbConnection.CreateCommand())
            {
                cmd.CommandText = "SELECT * FROM esc_profilelanguages WHERE account_id=@id";
                cmd.Parameters.AddWithValue("@id", (int)ViewBag.id);
                var reader = cmd.ExecuteReader();
                while (reader.Read())
                {
                    languages.Add(new UserLanguage()
                    {
                        Level = reader.GetInt32("level"),
                        Language = reader.GetInt32("language_id")
                    });
                }
            }
            dbConnection.Close();
            <!-- The Modal -->
            <div id="myModal" class="modal">
                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p>Some text in the Modal..</p>
                </div>
            </div>
            <div class="main-content">
                <aside class="left-column">
                    <div class="user-card">
                        <div class="user-profile-info">
                            <div class="user-profile-image">
                                @{
                                    if (sessionUser?.Id == user.Id)
                                    {
                                        <!-- PROFILE IMG START -->
                                        <div class="container clearfix" style="position:relative;width:100%;height:100%;margin:0;padding:0;cursor:pointer;">
                                            <div class="avatar1" style="background-image: url('@user.Picture')">
                                                <form id="newPictureForm" data-ajax="false" enctype="multipart/form-data" action="@Url.Action("SetPicture", "Auth")" method="post">
                                                    <svg version="1.1" id="camera" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 25 15" enable-background="new 0 0 25 15" xml:space="preserve">
                                                    <path id="cameraFrame" fill="none" stroke="white" stroke-miterlimit="10" d="M23.1,14.1H1.9c-0.6,0-1-0.4-1-1V1.9c0-0.6,0.4-1,1-1h21.2c0.6,0,1,0.4,1,1v11.3C24.1,13.7,23.7,14.1,23.1,14.1z" />







                                                    <path id="circle" fill="none" stroke="#ffffff" stroke-width="1.4" stroke-miterlimit="12" d="M17.7,7.5c0-2.8-2.3-5.2-5.2-5.2S7.3,4.7,7.3,7.5s2.3,5.2,5.2,5.2S17.7,10.3,17.7,7.5z" />







                                                    <g id="plus">
                                                    <path fill="none" id="plusLine" class="line" stroke="#ffffff" stroke-linecap="round" stroke-miterlimit="10" d="M20.9,2.3v4.4" />







                                                    <path fill="none" class="line" stroke="#ffffff" stroke-linecap="round" stroke-miterlimit="10" d="M18.7,4.6h4.4" />







                                                        </g>
                                                    </svg>
                                                    <div id="openModal">
                                                        <input name="file" id="fileUpload" type="file" />
                                                        <span>Drop here or<br /><a href="#" style="cursor:pointer;">Upload File</a></span>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <!-- PROFILE IMG END -->
                                    }
                                    else
                                    {
                                        <img src="@user.Picture" class="user-pict-img" alt="img description">
                                    }
                                }
                            </div>
                            <h1><a href="#">@user.FirstName @user.LastName</a></h1>
                            <div class="user-profile-label">
                                <div class="oneliner-wrapper">
                                    <small class="oneliner">@Escademy.Models.UserLevelMananger.GetRoleName(user.Level)</small>
                                    @{ 
                                        if (ViewBag.avgCountVal > 0) { 
                                    <div class="ratings-wrapper">
                                        @{
                                            if (ViewBag.avgStarVal == 1)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 2)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 3)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 4)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 1.5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star-half-alt"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 2.5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star-half-alt"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 3.5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star-half-alt"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 4.5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star-half-alt"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                            else if (ViewBag.avgStarVal == 5.5)
                                            {
                                                <span id="star1">
                                                    <ul class="ratings">
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star"></i></li>
                                                        <li><i class="fas fa-star-half-alt"></i></li>
                                                    </ul>
                                                </span>
                                            }
                                        }
                                        <p class="rating-text"><span class="total-rating-out-five" style="color: #555; font-weight: 700;" 9> @ViewBag.avgStarStr</span><span class="total-rating"> (@ViewBag.avgCountVal reviews)</span></p>

                                    </div>
                                            }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="buttons-wrapper">
                            <a href="javascript:;" onclick="StartConversation(@user.Id);" class="btn">Contact Me</a>
                        </div>
                        <div class="user-stats-desc">
                            <ul class="user-stats">
                                <li><i class="fas fa-map-marker-alt"></i> <span class="txt">From</span> <strong>@user.Country</strong></li>
                                <li>
                                    <i class="fas fa-user"></i> <span class="txt">Games</span>
                                    <strong style="text-align:right;">
                                        @{
                                            foreach (var game in uGames)
                                            {
                                                @game.Name<br />
                                            }
                                        }
                                    </strong>
                                </li>
                                <li style="padding: 0px; padding-bottom: 10px">
                                    <ul style="padding: 0px;width: 100%;">
                                        <li>
                                            <div>
                                                <i class="fas fa-star"></i>
                                                <span class="txt">ELO/Rating</span>
                                            </div>
                                            @if (sessionUser != null && sessionUser.Id == user.Id)
                                            {
                                                <a href="javascript:void(0);" id="addRating" onclick="showById('rating'); hideById('ratings')" class="add">Add new</a>
                                            }
                                        </li>
                                        <li>
                                            <strong style="text-align:right;" id="ratings">
                                                @if (gameRatings != null && gameRatings.Count > 0)
                                                {
                                                    foreach (var item in gameRatings)
                                                    {
                                                        <div>
                                                            @if (sessionUser?.Id == user.Id)
                                                            {
                                                                <i data-id="@item.Id" title="Delete" style="position:inherit;" onclick="deleteRating(this)" class="far fa-window-close delete-lang"></i>
                                                            }
                                                            <span data-id="@item.Id">@item.Name : @item.Rating</span>
                                                            <br />
                                                        </div>
                                                    }
                                                }
                                            </strong>
                                            <div id="rating" style="display: none;width: 100%; background-color: rgb(244, 244, 244); padding: 15px; border: 1px solid rgb(229, 229, 229); border-radius: 3px;">
                                                <form id="updateRatingForm" action="/api/User/UpdateRating" method="post">
                                                    <div class="autocomplete-wrap">
                                                        <div style="display: inline-block; width: 100%;">
                                                            <label for="autocomplete-2">Rating:</label>
                                                        </div>
                                                    </div>
                                                    <select class="capitalize" name="profilegamesId" id="ratingDropdown">
                                                        @foreach (var item in gamesAbbr)
                                                        {
                                                            <option value="@item.Id">@item.Abbreviation</option>
                                                        }
                                                    </select>
                                                    <input type="text" name="Rating" placeholder="Enter rating here." maxlength="10" class="form-control" />
                                                    <span class="buttons-wrapper">
                                                        <input type="submit" class="btn-lrg-standard add" value="Add">
                                                        <input type="button" class="btn-lrg-standard btn-white cancel" onclick="hideById('rating'); showById('ratings')" value="Cancel">
                                                    </span>
                                                </form>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                                <li style="padding: 0px;">
                                    <ul style="padding: 0px;width: 100%;">
                                        <li>
                                            <div>
                                                <i class="fas fa-trophy"></i>
                                                <span class="txt">Trophies</span>
                                            </div>
                                            @if (sessionUser != null && sessionUser.Id == user.Id)
                                            {
                                                <a href="javascript:void(0);" id="addTrophy" onclick="showById('trophy'); hideById('trophies')" class="add">Add new</a>
                                            }
                                        </li>
                                        <li>
                                            <strong style="text-align:right;" id="trophies">
                                                @if (uTrophies != null && uTrophies.Count > 0)
                                                {
                                                    foreach (var item in uTrophies)
                                                    {
                                                        <div>
                                                            @if (sessionUser?.Id == user.Id)
                                                            {
                                                                <i data-id="@item.Id" title="Delete" style="position:inherit;" onclick="deleteTrophy(this)" class="far fa-window-close delete-lang"></i>
                                                            }
                                                            <span>@item.Description</span><br />
                                                        </div>
                                                    }
                                                }
                                            </strong>
                                            <div id="trophy" style="display: none;width: 100%; background-color: rgb(244, 244, 244); padding: 15px; border: 1px solid rgb(229, 229, 229); border-radius: 3px;">
                                                <form id="updateTrophyForm" action="/api/User/UpdateTrophy" method="post">
                                                    <div class="autocomplete-wrap">
                                                        <div style="display: inline-block; width: 100%;">
                                                            <label for="autocomplete-2">Description:</label>
                                                        </div>
                                                    </div>
                                                    <input type="text" name="Description" placeholder="Enter description here." class="form-control" />
                                                    <span class="buttons-wrapper">
                                                        <input type="submit" class="btn-lrg-standard add" value="Add">
                                                        <input type="button" class="btn-lrg-standard btn-white cancel" onclick="hideById('trophy'); showById('trophies')" value="Cancel">
                                                    </span>
                                                </form>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="user-profile">
                        <div class="description">
                            @{
                                if (sessionUser != null && sessionUser.Id == user.Id)
                                {
                                    <a href="#" id="editdescription" class="add">Edit description</a>
                                }
                            }
                            <h2>Description</h2>
                            <p id="description" style="white-space: pre-line;">@user.Description</p>
                            <div class="form-wrapper" id="descriptioninfo" style="display: none;     background-color: #f4f4f4; margin: 0 -15px 20px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 3px;">
                                <form id="updateDescriptionForm" action="@Url.Action("UpdateDescription", "api/User")" method="post">
                                    <textarea maxlength="600" name="newDescription" placeholder="Please tell us about any hobbies, additional expertise, or anything else you�d like to add." style="resize: none; height: 130px; width: 100%; border: 0; border-bottom: 1px solid #e5e5e5; box-shadow: none;">@user.Description</textarea>
                                    <span class="buttons-wrapper">
                                        <input type="button" class="btn-lrg-standard btn-white cancel" id="cancelEdit" onclick="hideEditDescription()" value="Cancel">
                                        <input type="submit" class="btn-lrg-standard update" value="Update">
                                    </span>
                                </form>
                            </div>
                        </div>
                        <div class="languages">
                            @{
                                if (sessionUser != null && sessionUser.Id == user.Id)
                                {
                                    <a href="#" id="addlanguage" class="add">Add new</a>
                                }
                            }
                            <h2>Languages</h2>
                            <ul id="showLanguage">
                                @{
                                    foreach (var language in languages)
                                    {
                                        <li class="langli" data-id="@language.Language">
                                            @{
                                                if (sessionUser?.Id == user.Id)
                                                {
                                                    <i data-id="@language.Language" onclick="deleteLanguage(this)" class="far fa-window-close delete-lang"></i>
                                                }
                                            }
                                            @UserLanguage.GetLanguageString(language.Language) - <span>@UserLanguage.GetLevelText(language.Level)</span>
                                        </li>
                                    }
                                }
                            </ul>
                            <div class="form-row form-wrapper cf" id="language" style="display: none; background-color: #f4f4f4; margin: 0 -15px 20px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 3px;">
                                <form id="updateLanguageForm" action="@Url.Action("UpdateLanguage", "api/User")" method="post">
                                    <div class="autocomplete-wrap">
                                        <div style="display: inline-block; width: 100%;">
                                            <label for="autocomplete-2"></label>
                                            <select class="capitalize" name="Language">
                                                <option value="0" class="hidden">Language</option>
                                                @{
                                                    foreach (var lang in UserLanguage.GetCachedList())
                                                    {
                                                        <option value="@lang[0]">@lang[1]</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <select class="capitalize" name="Level">
                                        <option value="0" class="hidden">Language Level</option>
                                        <option value="1">Basic</option>
                                        <option value="2">Conversational</option>
                                        <option value="3">Fluent</option>
                                        <option value="4">Native/Bilingual</option>
                                    </select><span class="buttons-wrapper">
                                        <input type="submit" class="btn-lrg-standard add" value="Add">
                                        <input type="button" class="btn-lrg-standard btn-white cancel" onclick="hideAddLanguage()" value="Cancel">
                                    </span>
                                </form>
                            </div>
                        </div>
                        <!-- <div class="linked-accounts">
                            <h2>Linked Accounts</h2>
                            <ul>
                                <li><i class="fab fa-facebook-square"></i><span class="text">facebook</span></li>
                                <li><i class="fab fa-google-plus-square"></i><span class="text">google</span></li>
                                <li><i class="fab fa-linkedin"></i><span class="text">linkedin</span></li>
                            </ul>
                        </div>-->
                        <!--<div class="skills">
                            @{ if (sessionUser != null && sessionUser.Id == user.Id)
                                {<a href="#" id="addSkill" onclick="showAddSkill()" class="add">Add new</a> } }
                            <h2>Skills</h2>
                            <ul id="showSkill">
                                <li><a href="#">{user.Skills}</a></li>
                            </ul>
                            <div class="form-row form-wrapper cf" id="editSkill" style="display: none; background-color: #f4f4f4; margin: 0 -15px 20px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 3px;">
                                <div class="autocomplete-wrap">
                                    <div style="display: inline-block; width: 100%;">
                                        <label for="autocomplete-2"></label>
                                        <input type="text" placeholder="Add Skill" class="capitalize" role="combobox" aria-autocomplete="both" value="" id="autocomplete-2">
                                    </div>
                                </div>
                                <select class="capitalize">
                                    <option value="0" class="hidden">Experience Level</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="expert">Expert</option>
                                </select><span class="buttons-wrapper">
                                    <input type="submit" id="cancelAddSkill" class="btn-lrg-standard add" onclick="hideAddSkill()" value="Add">
                                    <input type="submit" class="btn-lrg-standard btn-white cancel" onclick="hideAddSkill()" value="Cancel">
                                </span>
                            </div>
                        </div>-->
                    </div>
                </aside>
                <div class="right-column">
                    <section class="articles-block">
                        <h1>@user.FirstName Coaching options</h1>
                        @*<button id="myBtn">Open Modal</button>*@
                        <div class="articles-row">
                            @{
                                foreach (var coaching in gameCoaches)
                                {
                                    if (coaching.Verified == 1 && coaching.ServiceType == 1)
                                    {
                                        <article class="article-box">
                                            <div class="box">
                                                <div class="img-holder">
                                                    <a href="@Url.Action("Detail", "Coaching", new { aId = coaching.AccountId, gId = coaching.GameId, @Id = coaching.Id })">
                                                        <div class="cf">
                                                            @if (coaching.GamePicture == "0")
                                                            {
                                                                <img src="~/Images/noImage.jpg" />
                                                            }
                                                            else
                                                            {
                                                                <img src="~/CoachingImages/@coaching.GamePicture" />
                                                            }
                                                        </div>
                                                    </a>
                                                </div>
                                                <div class="article-caption">
                                                    <header class="head">
                                                        <div class="avatar">
                                                            <img src="@user.Picture" alt="img description">
                                                        </div>
                                                        <div class="info-wrap">
                                                            <span class="name"><a href="@Url.Action("Profile", "Profiles", new { Id = coaching.AccountId })">@user.FirstName</a></span>
                                                            <span class="level">Offers coaching for @coaching.Abbreviation</span>
                                                        </div>
                                                    </header>
                                                    <div class="caption-body">
                                                        <h3 style="height:40px;"><a href="@Url.Action("Detail", "Coaching", new { aId = coaching.AccountId, gId = coaching.GameId, @Id = coaching.Id })">@coaching.Title</a></h3>
                                                        <div class="user-rating">
                                                            <i class="fas fa-user-graduate"></i>
                                                            <span><strong>@coaching.TotalCoached</strong>coached</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <footer class="foot">
                                                    <div class="icons-box">
                                                        <a href="@Url.Action("Detail", "Coaching", new { aId = coaching.AccountId, gId = coaching.GameId, @Id = coaching.Id })" class="list-icon">
                                                            <i class="far fa-credit-card"></i>
                                                        </a>
                                                        <a href="@Url.Action("Chat", "home", new { msgto = 1 })" class="list-icon"><i class="fas fa-comments"></i></a>
                                                    </div>
                                                    <div class="price">
                                                        <a href="@Url.Action("Detail", "Coaching", new { aId = coaching.AccountId, gId = coaching.GameId, @Id = coaching.Id })">$@coaching.Price<small>per hour</small></a>
                                                    </div>
                                                </footer>
                                            </div>
                                        </article>
                                    }
                                    else
                                    {
                                        continue;
                                    }
                                }
                            }
                        </div>
                    </section>
                    @{ if (ViewBag.avgCountVal > 0)
                        {
                            <h1> Reviews as Seller <i class="fas fa-star" style="color:#f89c2c"></i><span class="total-rating-out-five" style="color:#f29c29; font-weight:700;">@ViewBag.avgStarStr</span><span class="total-rating"> (@ViewBag.avgCountVal)</span></h1>
                        }
                        else
                        {
                            <h1> Reviews as Seller <i class="fas fa-star" style="color:#f89c2c"></i><span class="total-rating-out-five" style="color:#f29c29; font-weight:700;"></span><span class="total-rating"> (@ViewBag.avgCountVal)</span></h1>
                        }
                    }
                    @foreach (var item in Model)
                    {
                        <section class="reviews-content">
                            <header class="head">
                                @*<h1>Reviews as Seller<small><i class="fas fa-star"></i><span class="total-rating-out-five">@Html.DisplayFor(model => item.ReviewStars)</span><span class="total-rating">(@Html.DisplayFor(model => item.ReviewCount))</span></small></h1>*@
                                @*<select>
                        <option>Most Recent</option>
                        <option>Positive Reviews</option>
                        <option>Negative Reviews</option>
                    </select>*@
                            </header>
                            <div class="reviews-wrap">
                                <div class="comments-block">
                                    <!-- Spawned by profile-chat.js -->
                                    <ul class="review-list">
                                        <li>
                                            <span class="user-pic"><span class="missing-image-user">
                                                @*Loads default picture if user have no profile picture*@
                                                    @if (String.IsNullOrEmpty(item.ProfilePicture))
                                                    {
                                                    <img src="/Content/Images/portrait_2.png" alt="pic" />
                                                    }
                                                    else
                                                    {
                                                    <img src="data:image/png;base64,@item.ProfilePicture" />
                                                    }
                                                </span></span>
                                            <header class="subhead">
                                                <strong class="title">@Html.DisplayFor(model => item.Reviewer)</strong>
                                                <small>
                                                    <i class="fas fa-star"></i><span class="total-rating-out-five">@Html.DisplayFor(model => item.ReviewStars)</span>
                                                </small>
                                            </header>
                                            <p>@Html.DisplayFor(model => item.ReviewComments)</p>
                                            <span class="time">@Html.DisplayFor(model => item.ReviewDate)</span>
                                        </li>
                                    </ul>
                                    @*<div class="load-more-wrapper">
                            <a href="#" class="link-more">+ See More</a>
                        </div>*@
                                </div>
                            </div>
                        </section>
                    }
                </div>
            </div>
        }
        else
        {
            dbConnection.Open();
            var languages = new List<UserLanguage>();
            using (var cmd = dbConnection.CreateCommand())
            {
                cmd.CommandText = "SELECT * FROM esc_profilelanguages WHERE account_id=@id";
                cmd.Parameters.AddWithValue("@id", (int)ViewBag.id);
                var reader = cmd.ExecuteReader();
                while (reader.Read())
                {
                    languages.Add(new UserLanguage()
                    {
                        Level = reader.GetInt32("level"),
                        Language = reader.GetInt32("language_id")
                    });
                }
            }
            dbConnection.Close();
            <div class="main-content">
                <aside class="left-column">
                    <div class="user-card">
                        <div class="user-profile-info">
                            <div class="user-profile-image">
                                @{
                                    if (sessionUser?.Id == user.Id)
                                    {
                                        <!-- PROFILE IMG START -->
                                        <div class="container clearfix" style="position:relative;width:100%;height:100%;margin:0;padding:0;cursor:pointer;">
                                            <div class="avatar1" style="background-image: url('@user.Picture')">
                                                <form id="newPictureForm" data-ajax="false" enctype="multipart/form-data" action="@Url.Action("SetPicture", "Auth")" method="post">
                                                    <svg version="1.1" id="camera" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 25 15" enable-background="new 0 0 25 15" xml:space="preserve">
                                                    <path id="cameraFrame" fill="none" stroke="white" stroke-miterlimit="10" d="M23.1,14.1H1.9c-0.6,0-1-0.4-1-1V1.9c0-0.6,0.4-1,1-1h21.2c0.6,0,1,0.4,1,1v11.3C24.1,13.7,23.7,14.1,23.1,14.1z" />







                                                    <path id="circle" fill="none" stroke="#ffffff" stroke-width="1.4" stroke-miterlimit="12" d="M17.7,7.5c0-2.8-2.3-5.2-5.2-5.2S7.3,4.7,7.3,7.5s2.3,5.2,5.2,5.2S17.7,10.3,17.7,7.5z" />







                                                    <g id="plus">
                                                    <path fill="none" id="plusLine" class="line" stroke="#ffffff" stroke-linecap="round" stroke-miterlimit="10" d="M20.9,2.3v4.4" />







                                                    <path fill="none" class="line" stroke="#ffffff" stroke-linecap="round" stroke-miterlimit="10" d="M18.7,4.6h4.4" />







                                                        </g>
                                                    </svg>
                                                    <div id="openModal">
                                                        <input name="file" id="fileUpload" type="file" />
                                                        <span>Drop here or<br /><a href="#" style="cursor:pointer;">Upload File</a></span>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <!-- PROFILE IMG END -->
                                    }
                                    else
                                    {
                                        <img src="@user.Picture" class="user-pict-img" alt="img description">
                                    }
                                }
                            </div>
                            <h1><a href="#">@user.FirstName @user.LastName</a></h1>
                            <div class="user-profile-label">
                                <div class="oneliner-wrapper">
                                    <small class="oneliner">@Escademy.Models.UserLevelMananger.GetRoleName(user.Level)</small>
                                </div>
                            </div>
                        </div>
                        <div class="buttons-wrapper">
                            @*<a href="/home/Chat?msgto=@user.Id" class="btn">Contact Me</a>*@
                            <a href="javascript:;" onclick="StartConversation(@user.Id);" class="btn">Contact Me</a>
                        </div>
                    </div>
                    <div class="user-profile">
                        <div class="languages">
                            @{
                                if (sessionUser != null && sessionUser.Id == user.Id)
                                {
                                    <a href="#" id="addlanguage" class="add">Add new</a>
                                }
                            }
                            <h2>Languages</h2>
                            <ul id="showLanguage">
                                @*<li>  - <span>Primary Language</span></li>
                                    <li>Danish</li>*@
                                @{
                                    foreach (var language in languages)
                                    {
                                        <li class="langli" data-id="@language.Language">
                                            @{
                                                if (sessionUser?.Id == user.Id)
                                                {
                                                    <i data-id="@language.Language" onclick="deleteLanguage(this)" class="far fa-window-close delete-lang"></i>
                                                }
                                            }
                                            @UserLanguage.GetLanguageString(language.Language) - <span>@UserLanguage.GetLevelText(language.Level)</span>
                                        </li>
                                    }
                                }
                            </ul>
                            <div class="form-row form-wrapper cf" id="language" style="display: none; background-color: #f4f4f4; margin: 0 -15px 20px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 3px;">
                                <form id="updateLanguageForm" action="@Url.Action("UpdateLanguage", "api/User")" method="post">
                                    <div class="autocomplete-wrap">
                                        <div style="display: inline-block; width: 100%;">
                                            <label for="autocomplete-2"></label>
                                            @*<input type="text" name="Language" placeholder="Add Language" class="capitalize" role="combobox" aria-autocomplete="both" value="" id="autocomplete-2">*@
                                            <select class="capitalize" name="Language">
                                                <option value="0" class="hidden">Language</option>
                                                @*<option value="1">English</option>*@
                                                @{
                                                    foreach (var lang in UserLanguage.GetCachedList())
                                                    {
                                                        <option value="@lang[0]">@lang[1]</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                    <select class="capitalize" name="Level">
                                        <option value="0" class="hidden">Language Level</option>
                                        <option value="1">Basic</option>
                                        <option value="2">Conversational</option>
                                        <option value="3">Fluent</option>
                                        <option value="4">Native/Bilingual</option>
                                    </select><span class="buttons-wrapper">
                                        <input type="submit" class="btn-lrg-standard add" value="Add">
                                        <input type="button" class="btn-lrg-standard btn-white cancel" onclick="hideAddLanguage()" value="Cancel">
                                    </span>
                                </form>
                            </div>
                        </div>
                    </div>
                </aside>
                <div class="right-column">
                    <h1>
                        @user.FirstName @user.LastName
                        @{
                            if (sessionUser?.Id == user.Id)
                            {
                                <a href="#" style="text-align: right; float: right; font-size: 14px; color: #0056b3;" id="editdescription" class="add">
                                    Edit Description
                                </a>
                            }
                        }
                    </h1>
                    @{
                        if (user.Description.Length > 0)
                        {
                            <p id="description" style="white-space: pre-line">@user.Description</p>
                            <div class="form-wrapper" id="descriptioninfo" style="display: none;     background-color: #f4f4f4; margin: 0 -15px 20px; padding: 15px; border: 1px solid #e5e5e5; border-radius: 3px;">
                                <form id="updateDescriptionForm" action="@Url.Action("UpdateDescription", "api/User")" method="post">
                                    <textarea maxlength="600" name="newDescription" placeholder="Please tell us about any hobbies, additional expertise, or anything else you�d like to add." style="resize: none; height: 335px; width: 100%; border: 1px solid #c7c7c7; box-shadow: none;">@user.Description</textarea>
                                    <span class="buttons-wrapper">
                                        <input type="button" class="btn-lrg-standard btn-white cancel" id="cancelEdit" onclick="hideEditDescription()" value="Cancel">
                                        <input type="submit" class="btn-lrg-standard update" value="Update">
                                    </span>
                                </form>
                            </div>
                        }
                        else
                        {
                            <p>This is a private user with no description.</p>
                        }
                    }
                </div>
            </div>
        }
    }
}
